{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useNavigate}from'react-router-dom';import axios from\"axios\";import{QRCodeCanvas}from\"qrcode.react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TicketForm(){const navigate=useNavigate();const[personalId,setPersonalId]=useState(\"\");const[numbers,setNumbers]=useState(\"\");const[error,setError]=useState(\"\");const[success,setSuccess]=useState(null);const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[activeRound,setActiveRound]=useState(null);const[roundError,setRoundError]=useState(\"\");useEffect(()=>{const fetchUser=async()=>{try{const res=await axios.get(\"http://localhost:4000/profile\",{withCredentials:true});setUser(res.data);}catch(err){setUser(null);}finally{setLoading(false);}};fetchUser();},[]);useEffect(()=>{const fetchActiveRound=async()=>{try{const res=await axios.get(\"http://localhost:4000/activeRound\",{withCredentials:true});setActiveRound(res.data.roundId);}catch(err){if(err.response&&err.response.data&&err.response.data.message){setRoundError(err.response.data.message);}else{setRoundError(\"Greška pri dohvaćanju aktivne runde\");}}};fetchActiveRound();},[]);const handleSubmit=async e=>{e.preventDefault();setError(\"\");setSuccess(null);try{const res=await axios.post(\"http://localhost:4000/createTicket\",{personalId,numbers});setSuccess(res.data);}catch(err){if(err.response&&err.response.data){setError(err.response.data.error);}else{setError(\"Greška pri slanju podataka\");}}};useEffect(()=>{if(!loading&&!user){navigate('/');}},[user,loading,navigate]);if(!user){return null;}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Loto 6/45\"}),/*#__PURE__*/_jsx(\"a\",{href:\"http://localhost:3000/\",children:\"Povratak\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Prijavljen korisnik: \",user.name]}),/*#__PURE__*/_jsx(\"a\",{href:\"http://localhost:4000/logout\",children:/*#__PURE__*/_jsx(\"button\",{children:\"Logout\"})}),roundError&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:roundError}),activeRound&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Unos loto listi\\u0107a\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Broj osobne iskaznice / putovnice:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:personalId,maxLength:20,onChange:e=>setPersonalId(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Brojevi (6-10, odvojeni zarezom):\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:numbers,onChange:e=>setNumbers(e.target.value),required:true})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Po\\u0161alji listi\\u0107\"})]})]}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error}),success&&/*#__PURE__*/_jsxs(\"div\",{style:{color:\"green\"},children:[/*#__PURE__*/_jsx(\"p\",{children:\"Listi\\u0107 uspje\\u0161no poslan!\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Ticket ID: \",success.ticketId]}),/*#__PURE__*/_jsx(\"a\",{href:success.ticketUrl,target:\"_blank\",rel:\"noopener noreferrer\",children:/*#__PURE__*/_jsx(QRCodeCanvas,{value:success.ticketUrl,size:200,bgColor:\"#ffffff\",fgColor:\"#000000\",level:\"H\",includeMargin:true})})]})]});}export default TicketForm;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","axios","QRCodeCanvas","jsx","_jsx","jsxs","_jsxs","TicketForm","navigate","personalId","setPersonalId","numbers","setNumbers","error","setError","success","setSuccess","user","setUser","loading","setLoading","activeRound","setActiveRound","roundError","setRoundError","fetchUser","res","get","withCredentials","data","err","fetchActiveRound","roundId","response","message","handleSubmit","e","preventDefault","post","children","href","name","style","color","onSubmit","type","value","maxLength","onChange","target","required","ticketId","ticketUrl","rel","size","bgColor","fgColor","level","includeMargin"],"sources":["C:/Users/Stella/Documents/diplomski/web2/loto app/frontend/src/home/TicketForm.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from \"axios\";\r\nimport { QRCodeCanvas } from \"qrcode.react\";\r\n\r\n\r\nfunction TicketForm() {\r\n    const navigate = useNavigate();\r\n    const [personalId, setPersonalId] = useState(\"\");\r\n    const [numbers, setNumbers] = useState(\"\");\r\n    const [error, setError] = useState(\"\");\r\n    const [success, setSuccess] = useState(null);\r\n\r\n    const [user, setUser] = useState(null);\r\n\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const [activeRound, setActiveRound] = useState(null); \r\n    const [roundError, setRoundError] = useState(\"\"); \r\n\r\n    useEffect(() => {\r\n      const fetchUser = async () => {\r\n        try {\r\n          const res = await axios.get(\"http://localhost:4000/profile\", { withCredentials: true });\r\n          setUser(res.data);\r\n        } catch (err) {\r\n          setUser(null);\r\n        } finally {\r\n          setLoading(false); \r\n        }\r\n      };\r\n      fetchUser();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n      const fetchActiveRound = async () => {\r\n        try {\r\n          const res = await axios.get(\"http://localhost:4000/activeRound\", { withCredentials: true });\r\n          setActiveRound(res.data.roundId); \r\n        } catch (err) {\r\n          if (err.response && err.response.data && err.response.data.message) {\r\n            setRoundError(err.response.data.message); \r\n          } else {\r\n            setRoundError(\"Greška pri dohvaćanju aktivne runde\");\r\n          }\r\n        }\r\n      };\r\n      fetchActiveRound();\r\n    }, []);\r\n\r\n    const handleSubmit = async (e) => {\r\n      e.preventDefault();\r\n      setError(\"\");\r\n      setSuccess(null);\r\n\r\n      try {\r\n        const res = await axios.post(\r\n          \"http://localhost:4000/createTicket\",\r\n          { personalId, numbers }\r\n        );\r\n        setSuccess(res.data);\r\n      } catch (err) {\r\n        if (err.response && err.response.data) {\r\n          setError(err.response.data.error);\r\n        } else {\r\n          setError(\"Greška pri slanju podataka\");\r\n        }\r\n      }\r\n    };\r\n\r\n      useEffect(() => {\r\n        if (!loading && !user) {\r\n          navigate('/');\r\n        }\r\n      }, [user, loading, navigate]);\r\n\r\n    if (!user) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <h2>Loto 6/45</h2>\r\n        <a href=\"http://localhost:3000/\">Povratak</a>\r\n        <p>Prijavljen korisnik: {user.name}</p>\r\n        <a href=\"http://localhost:4000/logout\">\r\n          <button>Logout</button>\r\n        </a>\r\n\r\n        {roundError && <p style={{ color: \"red\" }}>{roundError}</p>}\r\n\r\n        {activeRound && (\r\n          <div>\r\n            <p>Unos loto listića</p>\r\n            <form onSubmit={handleSubmit}>\r\n              <div>\r\n                <label>Broj osobne iskaznice / putovnice:</label><br />\r\n                <input\r\n                  type=\"text\"\r\n                  value={personalId}\r\n                  maxLength={20}\r\n                  onChange={(e) => setPersonalId(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n              <div>\r\n                <label>Brojevi (6-10, odvojeni zarezom):</label><br />\r\n                <input\r\n                  type=\"text\"\r\n                  value={numbers}\r\n                  onChange={(e) => setNumbers(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n              <button type=\"submit\">Pošalji listić</button>\r\n            </form>\r\n          </div>\r\n        )}\r\n\r\n        {error && <p style={{ color: \"red\" }}>{error}</p>}\r\n        {success && (\r\n          <div style={{ color: \"green\" }}>\r\n            <p>Listić uspješno poslan!</p>\r\n            <p>Ticket ID: {success.ticketId}</p>\r\n            <a href={success.ticketUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n              <QRCodeCanvas\r\n                value={success.ticketUrl}\r\n                size={200}\r\n                bgColor=\"#ffffff\"\r\n                fgColor=\"#000000\"\r\n                level=\"H\"\r\n                includeMargin={true}\r\n              />\r\n            </a>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n}\r\n\r\nexport default TicketForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}